---
layout: post
title: "🙊 Web安全"
date: 2019-11-03 00:00:00
categories: [Web安全]
tags: [Web安全]
comments: true
---

<!--more-->

### 浏览器安全
#### 同源策略
同源策略是一种约定，它是浏览器最核心也是最基础的安全功能。同源指的是指URL的协议、域名、端口相同。

同源具体可以体现在两个方面：
- **DOM同源策略**：禁止对不同源的页面DOM进行操作
- **XmlHttpRequest同源策略**：禁止使用XHR对象向不同源的服务器地址发起HTTP请求。

#### 恶意网站拦截
恶意网址拦截的工作原理很简单，一般都是浏览器周期性地从服务器端获取一份最新的恶意网址黑名单，如果用户上网时访问的网址存在于此黑名单中，浏览器就会弹出一个警告页面。

### XSS：跨站脚本攻击
`XSS(Cross-Site Scripting，跨站脚本攻击)是一种代码注入攻击。攻击者在目标网站上注入恶意代码，当被攻击者登陆网站时就会执行这些恶意代码，这些脚本可以读取 cookie，session tokens，或者其它敏感的网站信息，对用户进行钓鱼欺诈，甚至发起蠕虫攻击等。`
XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，利用这些信息冒充用户向网站发起攻击者定义的请求。
#### 反射型XSS
把用户的输入“反射”到浏览器上，通常攻击者需要诱使用户点击一个恶意链接，才能攻击成功。

#### 存储型XSS
会把用户输入的数据“存储”在服务器端。这种XSS具有很强的稳定性。黑客把恶意的脚本保存到用户的服务器端，所以这种攻击就是存储型，理论上来说，它存在的时间是比较长的。
#### DOM型XSS
DOM 型 XSS 攻击，实际上就是前端 JavaScript 代码不够严谨，把不可信的内容插入到了页面。在使用 .innerHTML、.outerHTML、.appendChild、document.write()等API时要特别小心，不要把不可信的数据作为 HTML 插到页面上，尽量使用 .innerText、.textContent、.setAttribute() 等。

防范 DOM 型 XSS 攻击的核心就是对输入内容进行转义。

#### XSS的防御
  - **HttpOnly**：浏览器将禁止页面的JS访问带有HttpOnly属性的Cookie。
  - **输入检查**：一般是检查用户输入的数据中是否包含一些特殊字符，如<,>等等。如果发现这些字符，则将字符过滤或者编码
  - **输出检查**：一般来说，除了富文本的书除外，在变量输出到HTML页面时，可以使用编码或转移的方式来防御XSS攻击

### CSRS（Cross-site request forgery，跨站请求伪造）
`攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作。`

#### CSRF防御
- **添加验证码**（体验不好）
- **判断当前请求的来源：检测Referer**(并不安全，Referer可以被更改)
- **使用Token**(主流)
```javascript
//CSRF攻击之所以能够成功，是因为服务器误把攻击者发送的请求当成了用户自己的请求。那么我们可以要求所有的用户请求都携带一个CSRF攻击者无法获取到的Token。服务器通过校验请求是否携带正确的Token，来把正常的请求和攻击的请求区分开。跟验证码类似，只是用户无感知。
//- 服务端给用户生成一个token，加密后传递给用户
//- 用户在提交请求时，需要携带这个token
//- 服务端验证token是否正确
```

### 点击劫持ClickJacking
`原理：利用了视觉欺骗`

点击劫持是指在一个Web页面中隐藏了一个透明的iframe，用外层假页面诱导用户点击，实际上是在隐藏的frame上触发了点击事件进行一些用户不知情的操作。

#### 点击劫持防御
- **X-FRAME-OPTIONS**是微软提出的一个http头，专门用来防御利用iframe嵌套的点击劫持攻击。
```javascript
//可以设置为以下值:
//DENY: 拒绝任何域加载
//SAMEORIGIN: 允许同源域下加载
//ALLOW-FROM: 可以定义允许frame加载的页面地址
```
